
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Coupling and the Coupon Collector - kennary island</title>
  <meta name="author" content="Kenny Yu">

  
  <meta name="description" content="In the fall semester last year, I took Stat 110,
an introductory
statistics course focusing on probability. I had done probability in contest
math &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kennyyu.me/blog/2012/06/24/coupling-and-the-coupon-collector">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="kennary island" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25289622-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">kennary island</a></h1>
  
    <h2>eat, enjoy, explore</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kennyyu.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Coupling and the Coupon Collector</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-24T21:43:00-04:00" pubdate data-updated="true">Jun 24<span>th</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>In the fall semester last year, I took <a href="http://blog.bokcenter.harvard.edu/2012/01/23/stat-110-lectures-are-now-available-on-itunesu/">Stat 110</a>,
an introductory
statistics course focusing on probability. I had done probability in contest
math from high school, but this course was my first real rigorous treatment
of probability.</p>

<p>One of the most interesting problems I saw in the course involves Markov chains
and a simple and elegant solution using another interesting problem we saw
earlier in the course&#8211;<a href="http://en.wikipedia.org/wiki/Coupon_collector%27s_problem">the coupon collector&#8217;s problem</a>.</p>

<h2>Random-to-Top Shuffling Problem</h2>

<p>Suppose $n$ cards are placed in order on a table. Consider the following shuffling
procedure: Pick a card at random from the deck and place it on top of the deck.
What is the expected number of times we need to repeat the process to arrive
at a &#8220;random&#8221; deck, for some suitable definition of &#8220;random&#8221;?</p>

<p>To solve this question, we&#8217;ll need to answer a seemingly unrelated question first.</p>

<h2>Coupon Collector&#8217;s Problem (aka. The Toy Collector&#8217;s Problem)</h2>

<p>A certain brand of cereal always distributes a toy in every cereal box. The toy
chosen for each box is chosen randomly from a set of $n$ distinct toys. A toy
collector wishes to collect all $n$ distinct toys. What is the expected number
of cereal boxes must the toy collector buy so that the toy collector collects
all $n$ distinct toys?</p>

<h2>Solution to the Toy Collector&#8217;s Problem</h2>

<p>The key to understanding this problem is to break the task of collecting all
$n$ distinct toys into different stages: what is the expected number of cereal
boxes that the toy collector has to buy to get the $i$-th new toy?</p>

<p>Let random variable $X_i$ be the number of boxes it takes for the toy collector
to collect the $i$-th new toy after the $i-1$-th toy has already been collected.
(Note: this does NOT mean assign numbers to toys
and then collect the $i$-th toy. Instead, this means that after $X_i$ boxes,
the toy collector would have collected $i$ distinct toys, but with only $X_i - 1$
boxes, the toy collector would have only collected $i-1$ distinct toys.)</p>

<p>Clearly $E(X_1) = 1$, because the toy collector starts off with no toys. Now
consider the $i$-th toy. After the $i-1$-th toy has been collected, then there
are $n - (i-1)$ possible toys that could be the new $i$-th toy. We can interpret
the process of waiting for the $i$-th new toy as a <a href="http://en.wikipedia.org/wiki/Geometric_distribution">geometric distribution</a>, where
each trial is buying another cereal box, &#8220;success&#8221; is getting any of the
$n - (i-1)$ uncollected toys, and
&#8220;failure&#8221; is getting any of the already collected $i - 1$ toys. From this point
of view, we see that
$$X_i - 1 \sim \textrm{Geom}(p)$$
where the probability of success $p$ is
$$p = \frac{n - (i-1)}{n}.$$</p>

<p>Here, our definition of the geometric distribution does NOT include the success.
Using the expectation of a geometric distribution, we have that the expected number
of cereal boxes the toy collector must collect to get the $i$-th new toy after
collecting $i-1$ toys is
$$E(X_i - 1) = \frac{1 - p}{p}$$
$$E(X_i) = \frac{1}{p} = \frac{n}{n - (i - 1)}.$$</p>

<p>Now let random variable $X$ to be the number of cereal boxes the toy collector
needs to buy to collect all $n$ distinct toys. Since we have separated the
process into collecting the $i$-th new toy, then
$$X = X_1 + X_2 + \cdots + X_n.$$</p>

<p>Using linearity of expectation, we can compute the expected value of $X$
by summing the individual expectations of $X_i$. Thus, we obtain the following
result:
$$E(X) = E(X_1 + X_2 + X_3 + \cdots + X_n)$$
$$E(X) = E(X_1) + E(X_2) + E(X_3) + \cdots + E(X_n)$$
$$E(X) = n\left( 1 + \frac{1}{2} + \frac{1}{3} + \cdots + \frac{1}{n} \right).$$</p>

<p>This is the harmonic series! The harmonic series diverges to infinity and
grows approximately as $\gamma + \log n$ where $\gamma \approx 0.57722$ is
Euler&#8217;s constant. Thus, we can approximate the expected number of cereal boxes with:
$$E(X) \approx n (\gamma + \log n).$$</p>

<h2>Solution to the Random-to-Top Shuffling Problem</h2>

<h3>Markov Chains and Stationary Distrubutions</h3>

<p>Coming back to the random-to-top shuffling problem, we first need to define
our notion of &#8220;random&#8221; for our deck. In order to do this, we use Markov chains.</p>

<p>For our Markov chain, let our states be all $n!$ permutations of $n$-card deck,
and two states are adjacent if and only if it is possible to reach one of the
states from the other through one step of this shuffle. For any state, we move to
one of its $n-1$ neighbors with probability $\frac{1}{n}$, or stay at the same
state with probability $\frac{1}{n}$. Since all of our $n!$ states has degree
$n$ (including loops), then by symmetry, the probability of having any
permutation is equally likely. Thus, the stationary distribution for our
random-to-top shuffling Markov process is the uniform vector
$$\vec{s} = \left(\frac{1}{n!}, &#8230;, \frac{1}{n!}\right).$$</p>

<p>Thus, to define our notion of a &#8220;random&#8221; deck, we would like that after
implementing our shuffling algorithm, the resulting deck is sampled from our
stationary distribution: that is, our resulting deck is equally likely
to be any of the $n!$ permutations.</p>

<h3>Coupling</h3>

<p>Now that we have established that our shuffling process can be modeled with
a Markov chain that has a stationary distribution, we use the idea of &#8220;coupling&#8221;
to arrive at our solution.</p>

<p>Let deck $A$ be our original deck, and let deck $B$ be uniformly randomly sampled
from all $n!$ permutations. Since the stationary distribution for our shuffling
process is the uniform distribution, then deck $B$ is sampled from the
stationary distribution.</p>

<p>We use the fact that if we start our Markov process from a state sampled
from the stationary distribution, then the resulting state will also be
sampled from the stationary distribution. More formally:</p>

<p><strong>Lemma.</strong> <em>Let $\vec{s}$
be the stationary distribution of our Markov chain.
Let $X_0$ be our starting state, and let it
be sampled from the stationary distribution (i.e. $P(X_0 = i) = s_i$). Then
the resulting state $X_1$ after running the Markov chain for one step
will also be sampled from $\vec{s}$</em>.</p>

<p>Now consider our &#8220;coupling&#8221; strategy: every time we move a card $C$ to the top
of deck $A$, we locate card $C$ in deck $B$ and place it on top of the deck.
Note that the physical process of how we chose card $C$ in the two decks is
different: we choose a random position in deck $A$, whereas we located card
$C$ in deck $B$. Although the process of how we chose card $C$ is different,
from deck $B$&#8217;s perspective, $C$ is simply a card selected at random. Using
our lemma, we have that deck $B$ still remains sampled from the stationary
distribution after moving card $C$ to the top of deck $B$.</p>

<p>We note that after $t$ steps, all the cards that have been touched
up to time $t$ will be in the same order on top of both decks.
When all the cards of deck A and deck B are in the same order
after some time $T$ steps, we will have that deck A and deck B are both
sampled from the stationary distribution (because B always stays
stationary through our coupling strategy). Thus, after $T$ steps,
deck A will satisfy our notion of a &#8220;random&#8221; deck. We wish to compute $E(T)$.</p>

<p>How do we compute $E(T)$? We note that both decks will be the same once we have
touched all the cards. Therefore, we wish to compute the expected number
of random-to-top shuffles needed to touch all the cards.
This is an instance of the coupon collector&#8217;s problem! Instead of
touching all $n$ cards, we wish the collect all $n$ coupons. Thus,
after approximately $n (\gamma + \log n)$
random-to-top shuffles, our original deck $A$
will be a &#8220;random&#8221; deck. For $n = 52$, we require $E(T) \approx 236$ shuffles
to randomize our deck.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Kenny Yu</span></span>

      








  


<time datetime="2012-06-24T21:43:00-04:00" pubdate data-updated="true">Jun 24<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/coupling/'>coupling</a>, <a class='category' href='/blog/categories/markov-chains/'>markov chains</a>, <a class='category' href='/blog/categories/math/'>math</a>, <a class='category' href='/blog/categories/probability/'>probability</a>, <a class='category' href='/blog/categories/statistics/'>statistics</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://kennyyu.me/blog/2012/06/24/coupling-and-the-coupon-collector/" data-via="" data-counturl="http://kennyyu.me/blog/2012/06/24/coupling-and-the-coupon-collector/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/05/18/binary-search/" title="Previous Post: A Twist on Binary Search">&laquo; A Twist on Binary Search</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/08/22/java-flag-command-line-library/" title="next Post: Java Flag Command Line Library">Java Flag Command Line Library &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/03/19/c-error-handling/">C Error Handling</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/18/bootcamps/">Learning Through Bootcamps</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/20/omnibox-gdrive-search/">Omnibox GDrive Search</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/10/pipeline-for-improving-hand-tracking-accuracy/">Pipeline for Improving Hand Tracking Accuracy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/22/java-flag-command-line-library/">Java Flag Command Line Library</a>
      </li>
    
  </ul>
</section>




<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/binary-search' style='font-size: 120.0%'>binary search</a> <a href='/blog/categories/c' style='font-size: 120.0%'>c</a> <a href='/blog/categories/c-' style='font-size: 120.0%'>c++</a> <a href='/blog/categories/chrome-extension' style='font-size: 120.0%'>chrome extension</a> <a href='/blog/categories/compilers' style='font-size: 120.0%'>compilers</a> <a href='/blog/categories/computer-vision' style='font-size: 120.0%'>computer vision</a> <a href='/blog/categories/coupling' style='font-size: 120.0%'>coupling</a> <a href='/blog/categories/design' style='font-size: 120.0%'>design</a> <a href='/blog/categories/error-handling' style='font-size: 120.0%'>error handling</a> <a href='/blog/categories/flags' style='font-size: 120.0%'>flags</a> <a href='/blog/categories/git' style='font-size: 120.0%'>git</a> <a href='/blog/categories/java' style='font-size: 140.0%'>java</a> <a href='/blog/categories/javascript' style='font-size: 140.0%'>javascript</a> <a href='/blog/categories/knewton' style='font-size: 120.0%'>knewton</a> <a href='/blog/categories/layout' style='font-size: 120.0%'>layout</a> <a href='/blog/categories/markov-chains' style='font-size: 120.0%'>markov chains</a> <a href='/blog/categories/math' style='font-size: 160.0%'>math</a> <a href='/blog/categories/octopress' style='font-size: 140.0%'>octopress</a> <a href='/blog/categories/opencv' style='font-size: 120.0%'>opencv</a> <a href='/blog/categories/probability' style='font-size: 120.0%'>probability</a> <a href='/blog/categories/proofs' style='font-size: 120.0%'>proofs</a> <a href='/blog/categories/python' style='font-size: 140.0%'>python</a> <a href='/blog/categories/statistics' style='font-size: 120.0%'>statistics</a> <a href='/blog/categories/teaching' style='font-size: 120.0%'>teaching</a> <a href='/blog/categories/unix' style='font-size: 120.0%'>unix</a> </span>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/kennyyu">@kennyyu</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'kennyyu',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Kenny Yu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kennyyu';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://kennyyu.me/blog/2012/06/24/coupling-and-the-coupon-collector/';
        var disqus_url = 'http://kennyyu.me/blog/2012/06/24/coupling-and-the-coupon-collector/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
